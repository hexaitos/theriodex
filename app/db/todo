
def get_pokemon_moves_by_gen(pokemon_id, generation_id, language_id = 9)
	DB.results_as_hash = true
	results = DB.execute(<<-SQL, [ pokemon_id, language_id, language_id, language_id, pokemon_id, 1, language_id, language_id, generation_id ])
	SELECT
				CASE pokemonmove.level
					WHEN 0 THEN 'evo.'
					ELSE pokemonmove.level
				END AS level,
				name.name,
				COALESCE(move_change.type_id, move.type_id) AS type_id,
				typename.name,
				movedmgname.name,
				move.move_damage_class_id,
				COALESCE(move_change.power, move.power) AS power,
				COALESCE(move_change.accuracy, move.accuracy) AS accuracy,
				(movedmgname.move_damage_class_id <> 1 AND move.type_id IN (
					SELECT type_id
					FROM pokemon_v2_pokemontype
					WHERE pokemon_id = ?
				)) AS is_stab,
				vg.generation_id,
				genname.name,
				pokemonmove.move_id,
				gen_db.name as gen_db_name,
				sprites.sprites as sprites,
				vn.name as version_name

			FROM pokemon_v2_pokemonmove pokemonmove
			JOIN pokemon_v2_move move
				ON move.id = pokemonmove.move_id
			JOIN pokemon_v2_pokemonsprites sprites
				on sprites.pokemon_id = pokemonmove.pokemon_id
			JOIN pokemon_v2_movename name
				ON name.move_id = move.id
				AND name.language_id = ?
			JOIN pokemon_v2_movedamageclassname movedmgname
				ON movedmgname.move_damage_class_id = move.move_damage_class_id
				AND movedmgname.language_id = ?
			JOIN pokemon_v2_versiongroup vg
				ON vg.id = pokemonmove.version_group_id
			JOIN pokemon_v2_version version
				ON version.version_group_id = pokemonmove.version_group_id
			JOIN pokemon_v2_versionname vn
				ON vn.version_id = version.id AND vn.language_id = ?
			JOIN pokemon_v2_generationname genname
				ON genname.generation_id = vg.generation_id
			JOIN pokemon_v2_generation gen_db
				ON gen_db.id = genname.generation_id
			JOIN pokemon_v2_typename typename
				ON typename.type_id = COALESCE(move_change.type_id, move.type_id)
			LEFT JOIN pokemon_v2_movechange move_change
			ON move_change.move_id = pokemonmove.move_id
			AND move_change.version_group_id = (
					SELECT MIN(version_group_id)
					FROM pokemon_v2_movechange
					WHERE move_id = pokemonmove.move_id
						AND version_group_id > pokemonmove.version_group_id
			)
			WHERE
				pokemonmove.pokemon_id = ?
				AND pokemonmove.move_learn_method_id = ?
				AND genname.language_id = ?
				AND typename.language_id = ?
				AND vg.generation_id = ?
			ORDER BY
				pokemonmove.level,
				name.name ASC;
	SQL
	DB.results_as_hash = false
end
